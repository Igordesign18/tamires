<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LaBella Woman - Sistema PDV</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
            overflow-x: auto;
        }

        .tab {
            padding: 15px 30px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
            font-weight: 500;
            color: #495057;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }

        .tab-content {
            display: none;
            padding: 30px;
            animation: fadeIn 0.3s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s;
            margin: 5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-warning {
            background: #ffc107;
            color: #000;
        }

        .btn-info {
            background: #17a2b8;
            color: white;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #495057;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        table thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        table th,
        table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        table tbody tr:hover {
            background: #f8f9fa;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            animation: fadeIn 0.3s;
        }

        .modal.active {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #dee2e6;
        }

        .modal-header h2 {
            color: #667eea;
        }

        .close {
            font-size: 28px;
            cursor: pointer;
            color: #adb5bd;
            transition: color 0.3s;
        }

        .close:hover {
            color: #dc3545;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .cart-total {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
            text-align: right;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #dee2e6;
        }

        .status-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }

        .status-aberto {
            background: #d4edda;
            color: #155724;
        }

        .status-fechado {
            background: #f8d7da;
            color: #721c24;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .card h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .search-box {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 20px;
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .product-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            border-color: #667eea;
        }

        .product-card h4 {
            color: #495057;
            margin-bottom: 10px;
        }

        .product-card .price {
            font-size: 20px;
            font-weight: bold;
            color: #28a745;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
            font-size: 18px;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        @media print {
            body * {
                visibility: hidden;
            }
            .modal-content, .modal-content * {
                visibility: visible;
            }
            .modal-content {
                position: absolute;
                left: 0;
                top: 0;
            }
            .close, .btn {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üå∏ LaBella Woman</h1>
            <p>Sistema de Ponto de Venda</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="openTab('venda')">Nova Venda</button>
            <button class="tab" onclick="openTab('produtos')">Gerenciar Produtos</button>
            <button class="tab" onclick="openTab('clientes')">Gerenciar Clientes</button>
            <button class="tab" onclick="openTab('caixa')">Controle de Caixa</button>
            <button class="tab" onclick="openTab('movimentacoes')">Movimenta√ß√µes</button>
            <button class="tab" onclick="openTab('relatorios')">Relat√≥rios</button>
        </div>

        <!-- Aba Nova Venda -->
        <div id="venda" class="tab-content active">
            <h2>Nova Venda</h2>
            <input type="text" class="search-box" id="searchProduct" placeholder="üîç Buscar produto por nome ou SKU..." onkeyup="searchProducts()">
            <div class="product-grid" id="productGrid"></div>
            
            <div style="margin-top: 30px;">
                <h3>Carrinho</h3>
                <div id="cart"></div>
                <div class="cart-total" id="cartTotal">Total: R$ 0,00</div>
                <button class="btn btn-success" onclick="finalizarVenda()" style="width: 100%; margin-top: 20px; font-size: 18px;">Finalizar Venda</button>
            </div>
        </div>

        <!-- Aba Produtos -->
        <div id="produtos" class="tab-content">
            <h2>Gerenciar Produtos</h2>
            <button class="btn btn-primary" onclick="openModal('modalProduto')">+ Novo Produto</button>
            <table id="produtosTable">
                <thead>
                    <tr>
                        <th>SKU</th>
                        <th>Nome</th>
                        <th>Categoria</th>
                        <th>Tamanhos</th>
                        <th>Pre√ßo Venda</th>
                        <th>Pre√ßo Custo</th>
                        <th>Estoque</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <!-- Aba Clientes -->
        <div id="clientes" class="tab-content">
            <h2>Gerenciar Clientes</h2>
            <button class="btn btn-primary" onclick="openModal('modalCliente')">+ Novo Cliente</button>
            <table id="clientesTable">
                <thead>
                    <tr>
                        <th>Nome</th>
                        <th>Telefone</th>
                        <th>CPF</th>
                        <th>Email</th>
                        <th>Endere√ßo</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <!-- Aba Caixa -->
        <div id="caixa" class="tab-content">
            <h2>Controle de Caixa</h2>
            <div class="grid-2">
                <div class="card">
                    <h3>Status do Caixa</h3>
                    <div id="caixaStatus"></div>
                    <button class="btn btn-success" onclick="abrirCaixa()" id="btnAbrirCaixa">Abrir Caixa</button>
                    <button class="btn btn-danger" onclick="fecharCaixa()" id="btnFecharCaixa" style="display:none;">Fechar Caixa</button>
                </div>
            </div>
            <h3 style="margin-top: 30px;">Hist√≥rico de Caixas</h3>
            <table id="caixasTable">
                <thead>
                    <tr>
                        <th>Data Abertura</th>
                        <th>Data Fechamento</th>
                        <th>Valor Inicial</th>
                        <th>Valor Final</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <!-- Aba Movimenta√ß√µes -->
        <div id="movimentacoes" class="tab-content">
            <h2>Movimenta√ß√µes Financeiras</h2>
            <button class="btn btn-primary" onclick="openModal('modalMovimentacao')">+ Nova Movimenta√ß√£o</button>
            <table id="movimentacoesTable">
                <thead>
                    <tr>
                        <th>Data/Hora</th>
                        <th>Tipo</th>
                        <th>Descri√ß√£o</th>
                        <th>Valor</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <!-- Aba Relat√≥rios -->
        <div id="relatorios" class="tab-content">
            <h2>Relat√≥rios de Vendas</h2>
            <div class="grid-2">
                <div class="card">
                    <h3>Total de Vendas Hoje</h3>
                    <div id="vendasHoje" style="font-size: 32px; font-weight: bold; color: #28a745;">R$ 0,00</div>
                </div>
                <div class="card">
                    <h3>Quantidade de Vendas</h3>
                    <div id="qtdVendas" style="font-size: 32px; font-weight: bold; color: #667eea;">0</div>
                </div>
            </div>
            <h3 style="margin-top: 30px;">Vendas Recentes</h3>
            <table id="vendasTable">
                <thead>
                    <tr>
                        <th>Data/Hora</th>
                        <th>Cliente</th>
                        <th>Total</th>
                        <th>Pagamento</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <!-- Modal Produto -->
    <div id="modalProduto" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Novo Produto</h2>
                <span class="close" onclick="closeModal('modalProduto')">&times;</span>
            </div>
            <form onsubmit="salvarProduto(event)">
                <div class="form-group">
                    <label>SKU</label>
                    <input type="text" id="produtoSku" required>
                </div>
                <div class="form-group">
                    <label>Nome</label>
                    <input type="text" id="produtoNome" required>
                </div>
                <div class="form-group">
                    <label>Categoria</label>
                    <input type="text" id="produtoCategoria">
                </div>
                <div class="form-group">
                    <label>Tamanhos (separados por v√≠rgula)</label>
                    <input type="text" id="produtoTamanhos" placeholder="P, M, G, GG">
                </div>
                <div class="form-group">
                    <label>Pre√ßo de Venda</label>
                    <input type="number" step="0.01" id="produtoPrecoVenda" required>
                </div>
                <div class="form-group">
                    <label>Pre√ßo de Custo</label>
                    <input type="number" step="0.01" id="produtoPrecoCusto" required>
                </div>
                <div class="form-group">
                    <label>Estoque</label>
                    <input type="number" id="produtoEstoque" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Salvar Produto</button>
            </form>
        </div>
    </div>

    <!-- Modal Cliente -->
    <div id="modalCliente" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Novo Cliente</h2>
                <span class="close" onclick="closeModal('modalCliente')">&times;</span>
            </div>
            <form onsubmit="salvarCliente(event)">
                <div class="form-group">
                    <label>Nome</label>
                    <input type="text" id="clienteNome" required>
                </div>
                <div class="form-group">
                    <label>Telefone</label>
                    <input type="tel" id="clienteTelefone">
                </div>
                <div class="form-group">
                    <label>CPF</label>
                    <input type="text" id="clienteCpf">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="clienteEmail">
                </div>
                <div class="form-group">
                    <label>Endere√ßo</label>
                    <textarea id="clienteEndereco" rows="3"></textarea>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Salvar Cliente</button>
            </form>
        </div>
    </div>

    <!-- Modal Movimenta√ß√£o -->
    <div id="modalMovimentacao" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Nova Movimenta√ß√£o</h2>
                <span class="close" onclick="closeModal('modalMovimentacao')">&times;</span>
            </div>
            <form onsubmit="salvarMovimentacao(event)">
                <div class="form-group">
                    <label>Tipo</label>
                    <select id="movTipo" required>
                        <option value="entrada">Entrada</option>
                        <option value="saida">Sa√≠da</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Descri√ß√£o</label>
                    <input type="text" id="movDescricao" required>
                </div>
                <div class="form-group">
                    <label>Valor</label>
                    <input type="number" step="0.01" id="movValor" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Salvar Movimenta√ß√£o</button>
            </form>
        </div>
    </div>

    <!-- Modal Finalizar Venda -->
    <div id="modalFinalizarVenda" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Finalizar Venda</h2>
                <span class="close" onclick="closeModal('modalFinalizarVenda')">&times;</span>
            </div>
            <div class="form-group">
                <label>Cliente</label>
                <input type="text" id="vendaCliente" required list="clientesList">
                <datalist id="clientesList"></datalist>
            </div>
            <div class="form-group">
                <label>Forma de Pagamento</label>
                <select id="vendaPagamento" required>
                    <option value="dinheiro">Dinheiro</option>
                    <option value="cartao_credito">Cart√£o de Cr√©dito</option>
                    <option value="cartao_debito">Cart√£o de D√©bito</option>
                    <option value="pix">PIX</option>
                </select>
            </div>
            <div class="cart-total" id="vendaTotal">Total: R$ 0,00</div>
            <button class="btn btn-success" onclick="confirmarVenda()" style="width: 100%; margin-top: 20px;">Confirmar Venda</button>
        </div>
    </div>

    <!-- Modal Comprovante -->
    <div id="modalComprovante" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Comprovante de Venda</h2>
                <span class="close" onclick="closeModal('modalComprovante')">&times;</span>
            </div>
            <div id="comprovanteContent"></div>
            <button class="btn btn-primary" onclick="window.print()" style="width: 100%; margin-top: 20px;">Imprimir</button>
        </div>
    </div>

    <!-- Modal Tamanho -->
    <div id="modalTamanho" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Selecione o Tamanho</h2>
                <span class="close" onclick="closeModal('modalTamanho')">&times;</span>
            </div>
            <div id="tamanhoContent"></div>
        </div>
    </div>

    <script>
        // Configura√ß√£o do Supabase
        const SUPABASE_URL = "https://wplesjsjmgarbhuiuoeq.supabase.co";
        const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndwbGVzanNqbWdhcmJodWl1b2VxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAzNTc4NjIsImV4cCI6MjA3NTkzMzg2Mn0.c0NpxiZtWo6IPhjvf4eVKlXOyxskpyCBzCWXwqmTsPc";
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Estado da aplica√ß√£o
        let produtos = [];
        let clientes = [];
        let carrinho = [];
        let caixaAtual = null;
        let produtoSelecionado = null;

        // Inicializa√ß√£o
        window.onload = function() {
            carregarDados();
        };

        async function carregarDados() {
            await Promise.all([
                carregarProdutos(),
                carregarClientes(),
                carregarCaixaAtual(),
                carregarMovimentacoes(),
                carregarVendas()
            ]);
        }

        // Fun√ß√µes de Produtos
        async function carregarProdutos() {
            const { data, error } = await supabase.from("products").select("*").order("nome");
            if (error) {
                console.error("Erro ao carregar produtos:", error);
                return;
            }
            produtos = data || [];
            renderProdutos();
            renderProductGrid();
        }

        function renderProdutos() {
            const tbody = document.querySelector("#produtosTable tbody");
            tbody.innerHTML = produtos.map(p => `
                <tr>
                    <td>${p.sku}</td>
                    <td>${p.nome}</td>
                    <td>${p.categoria || "-"}</td>
                    <td>${Array.isArray(p.tamanhos) ? p.tamanhos.join(", ") : "-"}</td>
                    <td>R$ ${parseFloat(p.preco_venda).toFixed(2)}</td>
                    <td>R$ ${parseFloat(p.preco_custo).toFixed(2)}</td>
                    <td>${p.estoque}</td>
                    <td>
                        <button class="btn btn-danger" onclick="deletarProduto('${p.id}')">Excluir</button>
                    </td>
                </tr>
            `).join("");
        }

        function renderProductGrid() {
            const grid = document.getElementById("productGrid");
            grid.innerHTML = produtos.map(p => `
                <div class="product-card" onclick='adicionarAoCarrinho(${JSON.stringify(p).replace(/'/g, "&apos;")})'>
                    <h4>${p.nome}</h4>
                    <p style="color: #6c757d; font-size: 14px;">${p.sku}</p>
                    <p class="price">R$ ${parseFloat(p.preco_venda).toFixed(2)}</p>
                    <p style="color: #6c757d; font-size: 14px;">Estoque: ${p.estoque}</p>
                </div>
            `).join("");
        }

        function searchProducts() {
            const search = document.getElementById("searchProduct").value.toLowerCase();
            const filtered = produtos.filter(p => 
                p.nome.toLowerCase().includes(search) || 
                p.sku.toLowerCase().includes(search)
            );
            const grid = document.getElementById("productGrid");
            grid.innerHTML = filtered.map(p => `
                <div class="product-card" onclick='adicionarAoCarrinho(${JSON.stringify(p).replace(/'/g, "&apos;")})'>
                    <h4>${p.nome}</h4>
                    <p style="color: #6c757d; font-size: 14px;">${p.sku}</p>
                    <p class="price">R$ ${parseFloat(p.preco_venda).toFixed(2)}</p>
                    <p style="color: #6c757d; font-size: 14px;">Estoque: ${p.estoque}</p>
                </div>
            `).join("");
        }

        async function salvarProduto(event) {
            event.preventDefault();
            const tamanhos = document.getElementById("produtoTamanhos").value
                .split(",")
                .map(t => t.trim())
                .filter(t => t);

            const produto = {
                sku: document.getElementById("produtoSku").value,
                nome: document.getElementById("produtoNome").value,
                categoria: document.getElementById("produtoCategoria").value,
                tamanhos: tamanhos,
                preco_venda: parseFloat(document.getElementById("produtoPrecoVenda").value),
                preco_custo: parseFloat(document.getElementById("produtoPrecoCusto").value),
                estoque: parseInt(document.getElementById("produtoEstoque").value)
            };

            const { error } = await supabase.from("products").insert([produto]);
            if (error) {
                alert("Erro ao salvar produto: " + error.message);
                return;
            }

            alert("Produto salvo com sucesso!");
            closeModal("modalProduto");
            event.target.reset();
            carregarProdutos();
        }

        async function deletarProduto(id) {
            if (!confirm("Deseja realmente excluir este produto?")) return;
            const { error } = await supabase.from("products").delete().eq("id", id);
            if (error) {
                alert("Erro ao excluir produto: " + error.message);
                return;
            }
            carregarProdutos();
        }

        // Fun√ß√µes de Clientes
        async function carregarClientes() {
            const { data, error } = await supabase.from("clientes").select("*").order("nome");
            if (error) {
                console.error("Erro ao carregar clientes:", error);
                return;
            }
            clientes = data || [];
            renderClientes();
            renderClientesList();
        }

        function renderClientes() {
            const tbody = document.querySelector("#clientesTable tbody");
            tbody.innerHTML = clientes.map(c => `
                <tr>
                    <td>${c.nome}</td>
                    <td>${c.telefone || "-"}</td>
                    <td>${c.cpf || "-"}</td>
                    <td>${c.email || "-"}</td>
                    <td>${c.endereco || "-"}</td>
                    <td>
                        <button class="btn btn-danger" onclick="deletarCliente('${c.id}')">Excluir</button>
                    </td>
                </tr>
            `).join("");
        }

        function renderClientesList() {
            const datalist = document.getElementById("clientesList");
            datalist.innerHTML = clientes.map(c => `<option value="${c.nome}">`).join("");
        }

        async function salvarCliente(event) {
            event.preventDefault();
            const cliente = {
                nome: document.getElementById("clienteNome").value,
                telefone: document.getElementById("clienteTelefone").value,
                cpf: document.getElementById("clienteCpf").value,
                email: document.getElementById("clienteEmail").value,
                endereco: document.getElementById("clienteEndereco").value
            };

            const { error } = await supabase.from("clientes").insert([cliente]);
            if (error) {
                alert("Erro ao salvar cliente: " + error.message);
                return;
            }

            alert("Cliente salvo com sucesso!");
            closeModal("modalCliente");
            event.target.reset();
            carregarClientes();
        }

        async function deletarCliente(id) {
            if (!confirm("Deseja realmente excluir este cliente?")) return;
            const { error } = await supabase.from("clientes").delete().eq("id", id);
            if (error) {
                alert("Erro ao excluir cliente: " + error.message);
                return;
            }
            carregarClientes();
        }

        // Fun√ß√µes do Carrinho
        function adicionarAoCarrinho(produto) {
            if (produto.estoque <= 0) {
                alert("Produto sem estoque!");
                return;
            }

            if (produto.tamanhos && produto.tamanhos.length > 0) {
                produtoSelecionado = produto;
                mostrarModalTamanho(produto);
            } else {
                adicionarProdutoAoCarrinho(produto, null);
            }
        }

        function mostrarModalTamanho(produto) {
            const content = document.getElementById("tamanhoContent");
            content.innerHTML = `
                <p><strong>Produto:</strong> ${produto.nome}</p>
                <p><strong>Pre√ßo:</strong> R$ ${parseFloat(produto.preco_venda).toFixed(2)}</p>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); gap: 10px; margin-top: 20px;">
                    ${produto.tamanhos.map(t => `
                        <button class="btn btn-primary" onclick="selecionarTamanho('${t}')">${t}</button>
                    `).join("")}
                </div>
            `;
            openModal("modalTamanho");
        }

        function selecionarTamanho(tamanho) {
            adicionarProdutoAoCarrinho(produtoSelecionado, tamanho);
            closeModal("modalTamanho");
            produtoSelecionado = null;
        }

        function adicionarProdutoAoCarrinho(produto, tamanho) {
            const itemExistente = carrinho.find(item => 
                item.id === produto.id && item.tamanho === tamanho
            );

            if (itemExistente) {
                if (itemExistente.quantidade >= produto.estoque) {
                    alert("Quantidade m√°xima em estoque atingida!");
                    return;
                }
                itemExistente.quantidade++;
            } else {
                carrinho.push({
                    id: produto.id,
                    nome: produto.nome,
                    sku: produto.sku,
                    preco: produto.preco_venda,
                    quantidade: 1,
                    tamanho: tamanho,
                    estoque: produto.estoque
                });
            }

            renderCarrinho();
        }

        function renderCarrinho() {
            const cartDiv = document.getElementById("cart");
            if (carrinho.length === 0) {
                cartDiv.innerHTML = "<p style='text-align: center; color: #6c757d;'>Carrinho vazio</p>";
                document.getElementById("cartTotal").textContent = "Total: R$ 0,00";
                return;
            }

            cartDiv.innerHTML = carrinho.map((item, index) => `
                <div class="cart-item">
                    <div>
                        <strong>${item.nome}</strong>
                        ${item.tamanho ? `<span style="color: #6c757d;"> - Tamanho: ${item.tamanho}</span>` : ""}
                        <br>
                        <span style="color: #6c757d;">R$ ${parseFloat(item.preco).toFixed(2)} x ${item.quantidade}</span>
                    </div>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <button class="btn btn-warning" onclick="alterarQuantidade(${index}, -1)">-</button>
                        <span style="font-weight: bold;">${item.quantidade}</span>
                        <button class="btn btn-success" onclick="alterarQuantidade(${index}, 1)">+</button>
                        <button class="btn btn-danger" onclick="removerDoCarrinho(${index})">üóëÔ∏è</button>
                    </div>
                </div>
            `).join("");

            const total = carrinho.reduce((sum, item) => sum + (item.preco * item.quantidade), 0);
            document.getElementById("cartTotal").textContent = `Total: R$ ${total.toFixed(2)}`;
        }

        function alterarQuantidade(index, delta) {
            const item = carrinho[index];
            const novaQuantidade = item.quantidade + delta;

            if (novaQuantidade <= 0) {
                removerDoCarrinho(index);
                return;
            }

            if (novaQuantidade > item.estoque) {
                alert("Quantidade m√°xima em estoque atingida!");
                return;
            }

            item.quantidade = novaQuantidade;
            renderCarrinho();
        }

        function removerDoCarrinho(index) {
            carrinho.splice(index, 1);
            renderCarrinho();
        }

        function finalizarVenda() {
            if (carrinho.length === 0) {
                alert("Carrinho vazio!");
                return;
            }

            if (!caixaAtual) {
                alert("√â necess√°rio abrir o caixa antes de realizar vendas!");
                return;
            }

            const total = carrinho.reduce((sum, item) => sum + (item.preco * item.quantidade), 0);
            document.getElementById("vendaTotal").textContent = `Total: R$ ${total.toFixed(2)}`;
            openModal("modalFinalizarVenda");
        }

        async function confirmarVenda() {
            const cliente = document.getElementById("vendaCliente").value;
            const pagamento = document.getElementById("vendaPagamento").value;

            if (!cliente) {
                alert("Informe o nome do cliente!");
                return;
            }

            const venda = {
                data_hora: new Date().toISOString(),
                cliente_nome: cliente,
                total: carrinho.reduce((sum, item) => sum + (item.preco * item.quantidade), 0),
                forma_pagamento: pagamento,
                items: carrinho
            };

            const { data, error } = await supabase.from("vendas").insert([venda]).select();
            if (error) {
                alert("Erro ao salvar venda: " + error.message);
                return;
            }

            // Atualizar estoque
            for (const item of carrinho) {
                const produto = produtos.find(p => p.id === item.id);
                if (produto) {
                    await supabase
                        .from("products")
                        .update({ estoque: produto.estoque - item.quantidade })
                        .eq("id", item.id);
                }
            }

            closeModal("modalFinalizarVenda");
            mostrarComprovante(data[0]);
            carrinho = [];
            renderCarrinho();
            carregarProdutos();
            carregarVendas();
        }

        function mostrarComprovante(venda) {
            const content = document.getElementById("comprovanteContent");
            content.innerHTML = `
                <div style="text-align: center; margin-bottom: 20px;">
                    <h2>üå∏ LaBella Woman</h2>
                    <p>Comprovante de Venda</p>
                </div>
                <hr>
                <p><strong>Data:</strong> ${new Date(venda.data_hora).toLocaleString("pt-BR")}</p>
                <p><strong>Cliente:</strong> ${venda.cliente_nome}</p>
                <p><strong>Forma de Pagamento:</strong> ${venda.forma_pagamento}</p>
                <hr>
                <h3>Itens</h3>
                ${venda.items.map(item => `
                    <div style="display: flex; justify-content: space-between; margin: 10px 0;">
                        <span>${item.nome} ${item.tamanho ? `(${item.tamanho})` : ""} x${item.quantidade}</span>
                        <span>R$ ${(item.preco * item.quantidade).toFixed(2)}</span>
                    </div>
                `).join("")}
                <hr>
                <div style="text-align: right; font-size: 20px; font-weight: bold;">
                    Total: R$ ${parseFloat(venda.total).toFixed(2)}
                </div>
                <hr>
                <p style="text-align: center; margin-top: 20px;">Obrigado pela prefer√™ncia!</p>
            `;
            openModal("modalComprovante");
        }

        // Fun√ß√µes de Caixa
        async function carregarCaixaAtual() {
            const { data, error } = await supabase
                .from("caixas")
                .select("*")
                .eq("status", "aberto")
                .order("data_abertura", { ascending: false })
                .limit(1);

            if (error) {
                console.error("Erro ao carregar caixa:", error);
                return;
            }

            caixaAtual = data && data.length > 0 ? data[0] : null;
            renderCaixaStatus();
            carregarHistoricoCaixas();
        }

        function renderCaixaStatus() {
            const statusDiv = document.getElementById("caixaStatus");
            const btnAbrir = document.getElementById("btnAbrirCaixa");
            const btnFechar = document.getElementById("btnFecharCaixa");

            if (caixaAtual) {
                statusDiv.innerHTML = `
                    <span class="status-badge status-aberto">ABERTO</span>
                    <p style="margin-top: 15px;"><strong>Data Abertura:</strong> ${new Date(caixaAtual.data_abertura).toLocaleString("pt-BR")}</p>
                    <p><strong>Valor Inicial:</strong> R$ ${parseFloat(caixaAtual.valor_inicial).toFixed(2)}</p>
                `;
                btnAbrir.style.display = "none";
                btnFechar.style.display = "inline-block";
            } else {
                statusDiv.innerHTML = '<span class="status-badge status-fechado">FECHADO</span>';
                btnAbrir.style.display = "inline-block";
                btnFechar.style.display = "none";
            }
        }

        async function abrirCaixa() {
            const valor = prompt("Informe o valor inicial do caixa:");
            if (!valor) return;

            const caixa = {
                data_abertura: new Date().toISOString(),
                valor_inicial: parseFloat(valor),
                status: "aberto"
            };

            const { error } = await supabase.from("caixas").insert([caixa]);
            if (error) {
                alert("Erro ao abrir caixa: " + error.message);
                return;
            }

            alert("Caixa aberto com sucesso!");
            carregarCaixaAtual();
        }

        async function fecharCaixa() {
            const valor = prompt("Informe o valor final do caixa:");
            if (!valor) return;

            const { error } = await supabase
                .from("caixas")
                .update({
                    data_fechamento: new Date().toISOString(),
                    valor_final: parseFloat(valor),
                    status: "fechado"
                })
                .eq("id", caixaAtual.id);

            if (error) {
                alert("Erro ao fechar caixa: " + error.message);
                return;
            }

            alert("Caixa fechado com sucesso!");
            caixaAtual = null;
            carregarCaixaAtual();
        }

        async function carregarHistoricoCaixas() {
            const { data, error } = await supabase
                .from("caixas")
                .select("*")
                .order("data_abertura", { ascending: false })
                .limit(10);

            if (error) {
                console.error("Erro ao carregar hist√≥rico de caixas:", error);
                return;
            }

            const tbody = document.querySelector("#caixasTable tbody");
            tbody.innerHTML = (data || []).map(c => `
                <tr>
                    <td>${new Date(c.data_abertura).toLocaleString("pt-BR")}</td>
                    <td>${c.data_fechamento ? new Date(c.data_fechamento).toLocaleString("pt-BR") : "-"}</td>
                    <td>R$ ${parseFloat(c.valor_inicial).toFixed(2)}</td>
                    <td>${c.valor_final ? "R$ " + parseFloat(c.valor_final).toFixed(2) : "-"}</td>
                    <td><span class="status-badge status-${c.status}">${c.status.toUpperCase()}</span></td>
                </tr>
            `).join("");
        }

        // Fun√ß√µes de Movimenta√ß√µes
        async function carregarMovimentacoes() {
            const { data, error } = await supabase
                .from("movimentacoes")
                .select("*")
                .order("data_hora", { ascending: false })
                .limit(50);

            if (error) {
                console.error("Erro ao carregar movimenta√ß√µes:", error);
                return;
            }

            const tbody = document.querySelector("#movimentacoesTable tbody");
            tbody.innerHTML = (data || []).map(m => `
                <tr>
                    <td>${new Date(m.data_hora).toLocaleString("pt-BR")}</td>
                    <td><span class="status-badge ${m.tipo === 'entrada' ? 'status-aberto' : 'status-fechado'}">${m.tipo.toUpperCase()}</span></td>
                    <td>${m.descricao}</td>
                    <td style="color: ${m.tipo === 'entrada' ? '#28a745' : '#dc3545'}; font-weight: bold;">
                        ${m.tipo === 'entrada' ? '+' : '-'} R$ ${parseFloat(m.valor).toFixed(2)}
                    </td>
                </tr>
            `).join("");
        }

        async function salvarMovimentacao(event) {
            event.preventDefault();
            const movimentacao = {
                data_hora: new Date().toISOString(),
                tipo: document.getElementById("movTipo").value,
                descricao: document.getElementById("movDescricao").value,
                valor: parseFloat(document.getElementById("movValor").value)
            };

            const { error } = await supabase.from("movimentacoes").insert([movimentacao]);
            if (error) {
                alert("Erro ao salvar movimenta√ß√£o: " + error.message);
                return;
            }

            alert("Movimenta√ß√£o salva com sucesso!");
            closeModal("modalMovimentacao");
            event.target.reset();
            carregarMovimentacoes();
        }

        // Fun√ß√µes de Vendas
        async function carregarVendas() {
            const { data, error } = await supabase
                .from("vendas")
                .select("*")
                .order("data_hora", { ascending: false })
                .limit(50);

            if (error) {
                console.error("Erro ao carregar vendas:", error);
                return;
            }

            const vendas = data || [];
            
            // Calcular totais do dia
            const hoje = new Date().toDateString();
            const vendasHoje = vendas.filter(v => new Date(v.data_hora).toDateString() === hoje);
            const totalHoje = vendasHoje.reduce((sum, v) => sum + parseFloat(v.total), 0);

            document.getElementById("vendasHoje").textContent = `R$ ${totalHoje.toFixed(2)}`;
            document.getElementById("qtdVendas").textContent = vendasHoje.length;

            const tbody = document.querySelector("#vendasTable tbody");
            tbody.innerHTML = vendas.map(v => `
                <tr>
                    <td>${new Date(v.data_hora).toLocaleString("pt-BR")}</td>
                    <td>${v.cliente_nome}</td>
                    <td style="color: #28a745; font-weight: bold;">R$ ${parseFloat(v.total).toFixed(2)}</td>
                    <td>${v.forma_pagamento}</td>
                    <td>
                        <button class="btn btn-info" onclick='mostrarComprovante(${JSON.stringify(v).replace(/'/g, "&apos;")})'>Ver Comprovante</button>
                    </td>
                </tr>
            `).join("");
        }

        // Fun√ß√µes de Modal
        function openModal(modalId) {
            document.getElementById(modalId).classList.add("active");
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove("active");
        }

        // Fun√ß√µes de Tabs
        function openTab(tabName) {
            const tabs = document.querySelectorAll(".tab");
            const contents = document.querySelectorAll(".tab-content");

            tabs.forEach(t => t.classList.remove("active"));
            contents.forEach(c => c.classList.remove("active"));

            event.target.classList.add("active");
            document.getElementById(tabName).classList.add("active");
        }

        // Fechar modal ao clicar fora
        window.onclick = function(event) {
            if (event.target.classList.contains("modal")) {
                event.target.classList.remove("active");
            }
        };
    </script>
</body>
</html>
